import e from"@dpark/vue-bpmn";import n from"@dpark/bpmn-theme-blue";import{BTLayout as t,BTZoom as r,BTimeLine as i,utils as a}from"@dpark/vue-bpmn-controls";import s from"axios";var C={name:"VueBpmnViewer",props:{baseApi:{type:String,required:!0},instanceId:{type:String},xmlId:{type:String},type:{type:Number,required:!0},options:{type:Object,default:{zoom:!0,timeLine:!0}}},components:{VueBpmn:e,BTLayout:t,BTZoom:r,BTimeLine:i},data:()=>({loading:!1,bpmnViewer:null,timeLine_loading:!0,bpmnOptions:{additionalModules:[n]},taskData:[],url:{xmlUrl:"rest/model/loadXmlByModelId/",instanceUrl:"rest/formdetail/getprocessXml/",allExtensionTasks:"rest/extension/task/get-all-extension-tasks",exportUrl:"app/rest/models/[]/bpmn20?version=1617092632878",restModels:"app/rest/models/"}}),computed:{xml(){return this.clearWatermark(),a.clearAllHighLight(),1===this.type&&this.xmlId?(this.instanceId=null,this.options=Object.assign(this.options,{timeLine:!1}),`${this.baseApi}${this.url.xmlUrl}${this.xmlId}`):2===this.type&&this.instanceId?`${this.baseApi}${this.url.instanceUrl}${this.instanceId}`:void 0}},watch:{taskData:{handler:function(e){e.forEach((e=>{switch(e.status){case"已办":"驳回"===e.approveType?a.setTaskHighlight([e.taskDefinitionKey],{color:"#ff0000",setline:!1,shadow:!0}):a.setTaskHighlight([e.taskDefinitionKey],{color:"#5BC14B",setline:!1,shadow:!1});break;case"待办":a.setTaskHighlight([e.taskDefinitionKey],{color:"#f5842c",setline:!0,shadow:!1})}}))}},xml(){this.loading=!0}},methods:{getTaskList(){this.instanceId&&(this.taskData=[],s.get(this.baseApi+this.url.allExtensionTasks,{params:{initPageIndex:1,pageIndex:1,pageNum:1,pageSize:99,processInstanceId:this.instanceId}}).then((e=>{e.data.data.sort(((e,n)=>e.startTime-n.startTime)).forEach((e=>{a.setTaskMaxDay(e.taskDefinitionKey,e.customTaskMaxDay+"天"),e.realName&&a.setTaskRealName(e.taskDefinitionKey,e.realName),this.taskData.push(e)})),0===this.taskData.filter((e=>"待办"===e.status)).length&&a.setEndHighLight({stroke:"#5ac14a",fill:"#53D894"})})).catch((e=>{console.error(e)})).finally((()=>{this.timeLine_loading=!1})))},bpmnLoadDone(){this.loading=!1,this.options.timeLine&&this.getTaskList(),this.bpmnViewer=this.$refs.bpmnObj.bpmnViewer,window.bpmnViewer=this.bpmnViewer,setTimeout((()=>{this.$refs.cBTZoom.handleZoomReset()}),10)},bpmnLoadError(){this.instanceId=null,this.loading=!1},clearWatermark(){setTimeout((()=>{document.querySelector(".bjs-powered-by")&&document.querySelector(".bjs-powered-by").remove()}),300)}},mounted(){this.clearWatermark()}};function o(e,n,t,r,i,a,s,C,o,l){"boolean"!=typeof s&&(o=C,C=s,s=!1);const p="function"==typeof t?t.options:t;let d;if(e&&e.render&&(p.render=e.render,p.staticRenderFns=e.staticRenderFns,p._compiled=!0,i&&(p.functional=!0)),r&&(p._scopeId=r),a?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,o(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},p._ssrRegister=d):n&&(d=s?function(e){n.call(this,l(e,this.$root.$options.shadowRoot))}:function(e){n.call(this,C(e))}),d)if(p.functional){const e=p.render;p.render=function(n,t){return d.call(t),e(n,t)}}else{const e=p.beforeCreate;p.beforeCreate=e?[].concat(e,d):[d]}return t}const l="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function p(e){return(e,n)=>function(e,n){const t=l?n.media||"default":e,r=m[t]||(m[t]={ids:new Set,styles:[]});if(!r.ids.has(e)){r.ids.add(e);let t=n.source;if(n.map&&(t+="\n/*# sourceURL="+n.map.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n.map))))+" */"),r.element||(r.element=document.createElement("style"),r.element.type="text/css",n.media&&r.element.setAttribute("media",n.media),void 0===d&&(d=document.head||document.getElementsByTagName("head")[0]),d.appendChild(r.element)),"styleSheet"in r.element)r.styles.push(t),r.element.styleSheet.cssText=r.styles.filter(Boolean).join("\n");else{const e=r.ids.size-1,n=document.createTextNode(t),i=r.element.childNodes;i[e]&&r.element.removeChild(i[e]),i.length?r.element.insertBefore(n,i[e]):r.element.appendChild(n)}}}(e,n)}let d;const m={};const c=C;var h=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"bpmn-viewer"}},[t("a-spin",{attrs:{spinning:1===e.type&&e.loading||2===e.type&&e.timeLine_loading,tip:"加载中...",wrapperClassName:"bpmn-viewer-canvas"}},[e.instanceId&&2===e.type||e.xmlId&&1===e.type?t("vue-bpmn",{ref:"bpmnObj",attrs:{options:e.bpmnOptions,url:e.xml},on:{shown:e.bpmnLoadDone,loading:e.bpmnLoadDone,error:e.bpmnLoadError}}):t("div",{staticClass:"no-bpmn"},[t("img",{attrs:{src:e.getAssetsImg("data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3Csvg%20width%3D%22371px%22%20height%3D%22200px%22%20viewBox%3D%220%200%20371%20200%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%3E%20%20%20%20%3Ctitle%3E%E7%BC%96%E7%BB%84%204%3C%2Ftitle%3E%20%20%20%20%3Cdefs%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%22-47.0190124%25%22%20y1%3D%22-185.963888%25%22%20x2%3D%2268.8688465%25%22%20y2%3D%22100%25%22%20id%3D%22linearGradient-1%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%22118.999979%25%22%20y1%3D%22-110.864112%25%22%20x2%3D%2254.5018665%25%22%20y2%3D%2255.5871768%25%22%20id%3D%22linearGradient-2%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%2250%25%22%20y1%3D%22-221.156912%25%22%20x2%3D%2250%25%22%20y2%3D%22100%25%22%20id%3D%22linearGradient-3%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%22100.080959%25%22%20y1%3D%22-97.780461%25%22%20x2%3D%2238.826306%25%22%20y2%3D%22104.736078%25%22%20id%3D%22linearGradient-4%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%2250%25%22%20y1%3D%22-230.116303%25%22%20x2%3D%2250%25%22%20y2%3D%22100%25%22%20id%3D%22linearGradient-5%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%2250%25%22%20y1%3D%22-169.203289%25%22%20x2%3D%2250%25%22%20y2%3D%22100%25%22%20id%3D%22linearGradient-6%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23D2D2D2%22%20stop-opacity%3D%220%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%2294.0198096%25%22%20y1%3D%2256.553877%25%22%20x2%3D%2226.1827733%25%22%20y2%3D%2246.8352954%25%22%20id%3D%22linearGradient-7%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23C5C5C5%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23F6F6F6%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%223.70975156%25%22%20y1%3D%2213.4261896%25%22%20x2%3D%22170.734705%25%22%20y2%3D%22137.712351%25%22%20id%3D%22linearGradient-8%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23FFFFFF%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23C5C5C5%22%20offset%3D%2278.76%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%20%20%20%20%3ClinearGradient%20x1%3D%2210.3343933%25%22%20y1%3D%2232.4991182%25%22%20x2%3D%2286.4230962%25%22%20y2%3D%2294.0338827%25%22%20id%3D%22linearGradient-9%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%23DFF6F4%22%20offset%3D%220%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cstop%20stop-color%3D%22%231BD1D2%22%20offset%3D%22100%25%22%3E%3C%2Fstop%3E%20%20%20%20%20%20%20%20%3C%2FlinearGradient%3E%20%20%20%20%3C%2Fdefs%3E%20%20%20%20%3Cg%20id%3D%22%E9%A1%B5%E9%9D%A2-1%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%20%20%20%20%20%20%20%20%3Cg%20id%3D%22%E7%A9%BA%E7%8A%B6%E6%80%81%E5%9B%BE%E6%A0%87%E5%A4%87%E4%BB%BD%22%20transform%3D%22translate%28-958.000000%2C%20-1441.000000%29%22%20fill-rule%3D%22nonzero%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20id%3D%22%E7%BC%96%E7%BB%84-4%22%20transform%3D%22translate%28958.000000%2C%201441.000000%29%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20id%3D%22%E7%BC%96%E7%BB%84-2%E5%A4%87%E4%BB%BD%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M73.2592593%2C159.554082%20C65.345679%2C155.973835%2056.7654321%2C146.368897%2059.1975309%2C137.331859%20C60.4139859%2C137.020515%2061.693852%2C137.516587%2062.382716%2C138.566427%20C62.382716%2C138.566427%2076.1111111%2C160.010872%2072.2592593%2C140.282477%20C70.4444444%2C131.010872%2067.3209877%2C122.047909%2067.0740741%2C112.467662%20C66.6666667%2C95.0602545%2082.6419753%2C90.233094%2087.2345679%2C109.467662%20C87.8395062%2C112.010872%2090.1604938%2C132.689884%2095.4444444%2C130.319514%20C96.1250336%2C129.961557%2096.6773282%2C129.400632%2097.0246914%2C128.714576%20C99.7037037%2C124.319514%20100.506173%2C117.862724%20105.419753%2C116.368897%20C109.728395%2C115.010872%20113.975309%2C118.751613%20116.296296%2C122.61581%20C121%2C130.467662%20127.296296%2C149.98618%20117.666667%2C156.603464%20C108.037037%2C163.220748%2083.7407407%2C164.270131%2073.345679%2C159.640501%20L73.2592593%2C159.554082%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-1%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M273.185185%2C180.430625%20C269.703704%2C172.467662%20269.790123%2C159.591119%20277.691358%2C154.504699%20C278.808047%2C155.104911%20279.411159%2C156.355993%20279.185185%2C157.603464%20C279.185185%2C157.603464%20274.975309%2C182.726921%20285.358025%2C165.504699%20C290.296296%2C157.393588%20294%2C148.665193%20300.17284%2C141.393588%20C311.518519%2C128.134329%20326.641975%2C135.331859%20317.148148%2C152.677538%20C315.91358%2C154.973835%20303.740741%2C171.862724%20309.246914%2C173.665193%20C309.992355%2C173.848515%20310.775891%2C173.801158%20311.493827%2C173.52939%20C316.432099%2C172.0726%20321.37037%2C167.825687%20326.037037%2C169.973835%20C330.135802%2C171.862724%20330.777778%2C177.467662%20329.91358%2C181.899761%20C328.135802%2C190.875069%20319.421721%2C200.91212%20307.841474%2C199.356564%20C296.014314%2C197.751626%20277.777778%2C190.924452%20273.222222%2C180.517045%20L273.185185%2C180.430625%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-2%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M370.518519%2C199.356551%20C323.962963%2C167.418279%20258.17284%2C147.504699%20185.259259%2C147.504699%20C112.345679%2C147.504699%2046.5555556%2C167.418279%200%2C199.356551%20L370.518519%2C199.356551%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-3%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M293.469136%2C103.060255%20C290.518519%2C106.763958%20288.62963%2C112.010872%20290.395062%2C116.70223%20C291.617284%2C119.936798%20295.296296%2C119.961489%20295.037037%2C124.455316%20C294.783185%2C126.699169%20294.014206%2C128.854%20292.790123%2C130.751613%20C290.704251%2C134.400024%20288.14732%2C137.758071%20285.185185%2C140.739267%20C287.654305%2C142.665262%20288.910389%2C145.760781%20288.481481%2C148.862724%20C287.997231%2C151.941616%20286.539107%2C154.784309%20284.320988%2C156.973835%20C283.667879%2C157.772484%20282.816415%2C158.385539%20281.851852%2C158.751613%20C280.917648%2C158.967389%20279.94655%2C158.967389%20279.012346%2C158.751613%20C274.419062%2C157.972041%20269.959209%2C156.546384%20265.765432%2C154.517045%20C263.148148%2C153.270131%20260.481481%2C151.566427%20259.592593%2C148.850378%20C258.574074%2C145.733094%20260.19348%2C144.742546%20261.961179%2C143.765863%20L262.41743%2C143.513691%20C263.3302%2C143.004636%20264.22575%2C142.451348%20264.765432%2C141.566427%20C266.061728%2C139.442971%20266.098765%2C136.603464%20266.555556%2C134.233094%20C267.222222%2C130.739267%20266.234568%2C124.368897%20270.604938%2C122.998526%20C272.296296%2C122.467662%20274.135802%2C122.591119%20275.82716%2C122.047909%20C279.501372%2C120.878499%20281.022443%2C117.422242%20282.495104%2C113.927564%20L282.762795%2C113.292245%20C283.611763%2C111.282231%20284.486968%2C109.304653%20285.790123%2C107.78865%20C287.641975%2C105.628156%20292.234568%2C104.566427%20293.469136%2C103.060255%20Z%20M282.802469%2C123.78865%20C282.802469%2C123.78865%20269.506173%2C139.294822%20269.938272%2C153.628156%20L274.234568%2C153.628156%20C274.234568%2C153.628156%20275.790123%2C136.344205%20282.802469%2C123.78865%20Z%22%20id%3D%22%E5%BD%A2%E7%8A%B6%E7%BB%93%E5%90%88%22%20fill%3D%22url%28%23linearGradient-4%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M104.135802%2C22.0108718%20L104.135802%2C22.0108718%20C104.204481%2C17.2252075%20100.786222%2C13.0986863%2096.0713857%2C12.2755097%20C91.3565496%2C11.4523331%2086.7422233%2C14.1764226%2085.1851852%2C18.7022298%20C82.2145965%2C18.6439999%2079.4492011%2C20.2121758%2077.9742152%2C22.7913626%20C76.4992294%2C25.3705494%2076.5499916%2C28.54923%2078.1065814%2C31.0800038%20C79.6631712%2C33.6107776%2082.4772299%2C35.0898519%2085.4444444%2C34.9367977%20L103.333333%2C34.9367977%20C106.729866%2C34.891492%20109.517593%2C32.2362321%20109.72807%2C28.8459242%20C109.938548%2C25.4556163%20107.50065%2C22.4759385%20104.135802%2C22.0108718%20L104.135802%2C22.0108718%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-5%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M178.074074%2C12.2084027%20L178.074074%2C12.1466743%20C178.066799%2C6.23154854%20173.804253%2C1.17965438%20167.974706%2C0.177082054%20C162.14516%2C-0.825490268%20156.439779%2C2.51210807%20154.45679%2C8.08494589%20C148.848713%2C8.17358419%20144.374325%2C12.7916841%20144.462963%2C18.3997607%20C144.551601%2C24.0078373%20149.169701%2C28.4822262%20154.777778%2C28.3935879%20L177%2C28.3935879%20C181.281476%2C28.4012178%20184.829217%2C25.075029%20185.097306%2C20.8019475%20C185.365395%2C16.528866%20182.261202%2C12.7853409%20178.012346%2C12.2577854%20L178.074074%2C12.2084027%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-6%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20id%3D%22icon%E5%B1%80%E9%83%A8-04%22%20transform%3D%22translate%28116.000000%2C%2060.000000%29%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20id%3D%22%E7%BC%96%E7%BB%84%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M119.458101%2C17.1140039%20L0%2C17.1140039%20L0%2C7.0469428%20C0%2C3.1508594%203.1508594%2C0%207.0469428%2C0%20L112.398084%2C0%20C116.294167%2C0%20119.445027%2C3.1508594%20119.445027%2C7.0469428%20L119.445027%2C17.1140039%20L119.458101%2C17.1140039%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-7%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M107.809073%2C106.004846%20L11.6490279%2C106.004846%20C5.21656805%2C106.004846%200%2C100.788278%200%2C94.3427444%20L0%2C17.1140039%20L119.458101%2C17.1140039%20L119.458101%2C94.3558185%20C119.458101%2C100.788278%20114.241533%2C106.004846%20107.809073%2C106.004846%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-8%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccircle%20id%3D%22%E6%A4%AD%E5%9C%86%E5%BD%A2%22%20fill%3D%22%23FFFFFF%22%20cx%3D%229.51794872%22%20cy%3D%229.13879966%22%20r%3D%222.01341223%22%3E%3C%2Fcircle%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccircle%20id%3D%22%E6%A4%AD%E5%9C%86%E5%BD%A2%22%20fill%3D%22%23FFFFFF%22%20cx%3D%2216.5256692%22%20cy%3D%229.13879966%22%20r%3D%222.01341223%22%3E%3C%2Fcircle%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccircle%20id%3D%22%E6%A4%AD%E5%9C%86%E5%BD%A2%22%20fill%3D%22%23FFFFFF%22%20cx%3D%2223.5333897%22%20cy%3D%229.13879966%22%20r%3D%222.01341223%22%3E%3C%2Fcircle%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M47.9803749%2C68.3402801%20L37.6500551%2C58.0088213%20L48.0368247%2C47.6209064%20C49.3210584%2C46.336531%2049.3210584%2C44.2476569%2048.0368247%2C42.9632815%20C46.752591%2C41.6789062%2044.6639471%2C41.6789062%2043.3797133%2C42.9632815%20L32.9929438%2C53.3511964%20L22.6202867%2C42.9632815%20C21.9993385%2C42.3422649%2021.1667034%2C42.0035285%2020.291731%2C42.0035285%20C19.4167585%2C42.0035285%2018.5841235%2C42.3422649%2017.9631753%2C42.9632815%20C16.6789416%2C44.2476569%2016.6789416%2C46.336531%2017.9631753%2C47.6209064%20L28.3499449%2C57.9947072%20L17.9631753%2C68.3826221%20C16.693054%2C69.6669975%2016.693054%2C71.7417576%2017.9631753%2C73.026133%20C18.5841235%2C73.6471496%2019.4167585%2C74%2020.291731%2C74%20C20.291731%2C74%2020.291731%2C74%2020.291731%2C74%20C21.1667034%2C74%2021.9993385%2C73.6612636%2022.6202867%2C73.026133%20L32.9929438%2C62.6523321%20L43.3656009%2C73.026133%20C44.5651599%2C74.0564561%2046.3715546%2C74.0564561%2047.6134509%2C72.9837909%20C49.0105843%2C71.7982137%2049.1658214%2C69.7234535%2047.9803749%2C68.3402801%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22%23FFFFFF%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%2860.140885%2C%2038.977177%29%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20fill%3D%22%23D0D0D0%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M41.7848408%2C0.0490278952%20L49.4854889%2C0.0490278952%20C50.5706396%2C0.0490278952%2051.4466047%2C0.924992956%2051.4466047%2C2.0101437%20L51.4466047%2C2.0101437%20C51.4466047%2C3.09529445%2050.5706396%2C3.97125951%2049.4854889%2C3.97125951%20L41.7848408%2C3.97125951%20C40.6996901%2C3.97125951%2039.823725%2C3.09529445%2039.823725%2C2.0101437%20C39.823725%2C0.924992956%2040.6996901%2C0.0490278952%2041.7848408%2C0.0490278952%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M2.54945055%2C0.0490278952%20L33.7181178%2C0.0490278952%20C34.8032685%2C0.0490278952%2035.6792336%2C0.924992956%2035.6792336%2C2.0101437%20C35.6792336%2C3.09529445%2034.8032685%2C3.97125951%2033.7181178%2C3.97125951%20L2.54945055%2C3.97125951%20C1.4642998%2C3.97125951%200.588334742%2C3.09529445%200.588334742%2C2.0101437%20C0.588334742%2C0.924992956%201.4642998%2C0.0490278952%202.54945055%2C0.0490278952%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%280.000000%2C%2016.996337%29%22%20fill%3D%22%23FFFFFF%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M22.6312764%2C0.20591716%20L49.4854889%2C0.20591716%20C50.5706396%2C0.20591716%2051.4466047%2C1.08188222%2051.4466047%2C2.16703297%20L51.4466047%2C2.16703297%20C51.4466047%2C3.25218371%2050.5706396%2C4.12814877%2049.4854889%2C4.12814877%20L22.6312764%2C4.12814877%20C21.5461257%2C4.12814877%2020.6701606%2C3.25218371%2020.6701606%2C2.16703297%20C20.6701606%2C1.09495633%2021.5461257%2C0.20591716%2022.6312764%2C0.20591716%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M2.54945055%2C0.20591716%20L14.760665%2C0.20591716%20C15.8458157%2C0.20591716%2016.7217808%2C1.08188222%2016.7217808%2C2.16703297%20C16.7217808%2C3.25218371%2015.8458157%2C4.12814877%2014.760665%2C4.12814877%20L2.54945055%2C4.12814877%20C1.4642998%2C4.12814877%200.588192363%2C3.25218371%200.588192363%2C2.16703297%20C0.575260637%2C1.09495633%201.4642998%2C0.20591716%202.54945055%2C0.20591716%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%280.000000%2C%2034.237813%29%22%20fill%3D%22%23FFFFFF%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M32.3976331%2C0.117666948%20L44.2296985%2C0.117666948%20C45.0010707%2C0.117666948%2045.6417019%2C0.993632009%2045.6417019%2C2.07878276%20L45.6417019%2C2.07878276%20C45.6417019%2C3.1639335%2045.0141448%2C4.03989856%2044.2296985%2C4.03989856%20L32.3976331%2C4.03989856%20C31.6262609%2C4.03989856%2030.9856298%2C3.1639335%2030.9856298%2C2.07878276%20C30.9856298%2C0.993632009%2031.6131868%2C0.117666948%2032.3976331%2C0.117666948%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M2.54945055%2C0.117666948%20L21.1669766%2C0.117666948%20C22.2521274%2C0.117666948%2023.1280924%2C0.993632009%2023.1280924%2C2.07878276%20C23.1280924%2C3.1639335%2022.2521274%2C4.03989856%2021.1669766%2C4.03989856%20L2.54945055%2C4.03989856%20C1.4642998%2C4.03989856%200.588192363%2C3.1639335%200.588192363%2C2.07878276%20C0.575260637%2C0.993632009%201.4642998%2C0.117666948%202.54945055%2C0.117666948%20Z%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20id%3D%22%E7%BC%96%E7%BB%84%22%20transform%3D%22translate%2879.915469%2C%2043.144548%29%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M68.4167935%2C54.2444632%20C64.9521555%2C54.2444632%2061.8928149%2C55.957171%2060.0101437%2C58.5719921%20L49.0148211%2C52.9109045%20C49.9038602%2C50.989011%2050.4398986%2C48.8710059%2050.4398986%2C46.6222598%20C50.4398986%2C44.0597351%2049.746971%2C41.680248%2048.6095238%2C39.575317%20L55.0289096%2C36.9212736%20C55.6041702%2C37.8887574%2056.2970978%2C38.8039448%2057.2122852%2C39.5622429%20C61.5921105%2C43.2752888%2068.1422372%2C42.7392505%2071.8552832%2C38.3594252%20C75.5683291%2C33.9795999%2075.0322908%2C27.4294731%2070.6524655%2C23.7164272%20C66.2726402%2C20.0033812%2059.7225134%2C20.5394196%2056.0094675%2C24.9192449%20C53.7607213%2C27.5602141%2053.093942%2C30.9987039%2053.8783883%2C34.1364892%20L46.8837419%2C37.0258664%20C44.4519583%2C34.1364892%2040.9611722%2C32.2015216%2036.9866441%2C31.7962243%20L36.9866441%2C21.5984221%20C42.0071006%2C20.8531981%2045.8639617%2C16.5779656%2045.8639617%2C11.3483235%20C45.8639617%2C5.60879121%2041.2095802%2C0.954409693%2035.4700479%2C0.954409693%20C29.7305156%2C0.954409693%2025.0761341%2C5.60879121%2025.0761341%2C11.3483235%20C25.0761341%2C16.5648915%2028.9460693%2C20.8531981%2033.9534517%2C21.5984221%20L33.9534517%2C31.7962243%20C26.4096929%2C32.5675965%2020.4871231%2C38.8693153%2020.4871231%2C46.6222598%20C20.4871231%2C50.3483798%2021.8991265%2C53.721499%2024.1478726%2C56.3363201%20L19.6111581%2C58.6635108%20C17.7284869%2C55.9440969%2014.6037757%2C54.1660186%2011.0606932%2C54.1660186%20C5.32116089%2C54.1660186%200.666779374%2C58.8204001%200.666779374%2C64.5599324%20C0.666779374%2C70.2994646%205.32116089%2C74.9538462%2011.0606932%2C74.9538462%20C16.8002254%2C74.9538462%2021.4284587%2C70.2994646%2021.4284587%2C64.5599324%20C21.4284587%2C63.4486334%2021.219273%2C62.402705%2020.8924204%2C61.409073%20L26.4489152%2C58.558918%20C28.9591434%2C60.4546633%2032.0577064%2C61.6182587%2035.4308256%2C61.6182587%20C40.3597633%2C61.6182587%2044.7003663%2C59.1995492%2047.4197802%2C55.5257256%20L58.6112144%2C61.2783319%20C58.2451395%2C62.3373345%2057.9967315%2C63.4617075%2057.9967315%2C64.6514511%20C57.9967315%2C70.3909834%2062.651113%2C75.0453649%2068.3906453%2C75.0453649%20C74.1301775%2C75.0453649%2078.784559%2C70.3909834%2078.784559%2C64.6514511%20C78.784559%2C58.9119189%2074.1563257%2C54.2444632%2068.4167935%2C54.2444632%20L68.4167935%2C54.2444632%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22url%28%23linearGradient-9%29%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cpath%20d%3D%22M24.8538743%2C49.0932657%20C23.7687236%2C49.0932657%2022.8927585%2C48.2173006%2022.8927585%2C47.1321499%20C22.8927585%2C40.1636517%2028.5538462%2C34.5025641%2035.5223443%2C34.5025641%20C36.6074951%2C34.5025641%2037.4834601%2C35.3785292%2037.4834601%2C36.4636799%20C37.4834601%2C37.5488307%2036.6074951%2C38.4247957%2035.5223443%2C38.4247957%20C30.7241476%2C38.4247957%2026.8149901%2C42.3339532%2026.8149901%2C47.1321499%20C26.8149901%2C48.2042265%2025.9390251%2C49.0932657%2024.8538743%2C49.0932657%20Z%22%20id%3D%22%E8%B7%AF%E5%BE%84%22%20fill%3D%22%23FFFFFF%22%3E%3C%2Fpath%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%3C%2Fg%3E%3C%2Fsvg%3E")}})])],1),e._v(" "),t("BTLayout",[t("template",{slot:"head"},[e._t("default")],2),e._v(" "),t("template",{slot:"right"},[t("BTZoom",{directives:[{name:"show",rawName:"v-show",value:(2===e.type&&e.instanceId||1===e.type&&e.xmlId)&&e.options.zoom&&!e.loading,expression:"(type===2&&instanceId||type===1&&xmlId)&&options.zoom&&!loading"}],ref:"cBTZoom",attrs:{bpmnViewer:e.bpmnViewer}}),e._v(" "),2===e.type&&e.instanceId&&e.options.timeLine&&!e.loading?e._t("timeLine",[t("BTimeLine",{attrs:{loading:e.timeLine_loading,data:e.taskData}})],{loading:e.timeLine_loading,data:e.taskData}):e._e()],2)],2)],1)};h._withStripped=!0;const D=o({render:h,staticRenderFns:[]},(function(e){e&&(e("data-v-60702b8d_0",{source:"\n#bpmn-viewer[data-v-60702b8d]{\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #F5F5F7;\r\n  cursor: grab;\n}\n#bpmn-viewer[data-v-60702b8d]:active{\r\n  cursor: grabbing;\n}\n.bpmn-viewer-canvas[data-v-60702b8d]{\r\n  width: 100%;\r\n  height: 100%;\n}\n.no-bpmn[data-v-60702b8d]{\r\n  text-align: center;\n}\n.no-bpmn img[data-v-60702b8d]{\r\n  display: inline-block;\r\n  margin-top: 100px;\r\n  width: 700px;\n}\r\n",map:{version:3,sources:["E:\\gitlab\\flowable_v3\\sipsd-flowable-editor\\src\\packages\\vue-bpmn-viewer\\VueBpmnViewer.vue"],names:[],mappings:";AAiKA;EACA,WAAA;EACA,YAAA;EACA,mBAAA;EACA,YAAA;AACA;AACA;EACA,gBAAA;AACA;AACA;EACA,WAAA;EACA,YAAA;AACA;AACA;EACA,kBAAA;AACA;AACA;EACA,qBAAA;EACA,iBAAA;EACA,YAAA;AACA",file:"VueBpmnViewer.vue",sourcesContent:['<template>\r\n  <div id="bpmn-viewer">\r\n    <a-spin :spinning="(type===1&&loading)||(type===2&&timeLine_loading)" tip="加载中..."  wrapperClassName="bpmn-viewer-canvas">\r\n      <vue-bpmn v-if="(instanceId&&type===2)||(xmlId&&type===1)" ref="bpmnObj" :options="bpmnOptions" :url="xml" @shown="bpmnLoadDone" @loading="bpmnLoadDone" @error="bpmnLoadError"></vue-bpmn>\r\n      <div v-else class="no-bpmn">\r\n        <img :src="getAssetsImg(require(\'./assets/no-bpmn.svg\'))">\r\n      </div>\r\n    </a-spin>\r\n    <BTLayout>\r\n      <template slot="head">\r\n        <slot></slot>\r\n      </template>\r\n      <template slot="right">\r\n        <BTZoom v-show="(type===2&&instanceId||type===1&&xmlId)&&options.zoom&&!loading" :bpmnViewer="bpmnViewer" ref="cBTZoom"/>\r\n        <slot name="timeLine" v-if="type===2&&instanceId&&options.timeLine&&!loading" v-bind:loading="timeLine_loading" v-bind:data="taskData">\r\n          <BTimeLine :loading="timeLine_loading" :data="taskData"/>\r\n        </slot>\r\n      </template>\r\n    </BTLayout>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VueBpmn from \'@dpark/vue-bpmn\';\r\nimport bpmnThemeBlue from \'@dpark/bpmn-theme-blue\'\r\nimport {BTimeLine,utils,BTLayout,BTZoom} from \'@dpark/vue-bpmn-controls\'\r\nimport axios from \'axios\'\r\nexport default {\r\n  name: "VueBpmnViewer",\r\n  props:{\r\n    baseApi:{type:String,required:true},\r\n    instanceId:{type:String},\r\n    xmlId:{type:String},\r\n    type:{type:Number,required: true},\r\n    options:{type:Object,default:{\r\n      zoom:true,\r\n      timeLine:true\r\n    }}\r\n  },\r\n  components:{\r\n    VueBpmn,\r\n    BTLayout,\r\n    BTZoom,\r\n    BTimeLine,\r\n  },\r\n  data(){\r\n    return {\r\n      loading:false,\r\n      bpmnViewer:null,\r\n      timeLine_loading:true,\r\n      bpmnOptions:{\r\n        additionalModules:[bpmnThemeBlue]\r\n      },\r\n      taskData:[],\r\n      url:{\r\n        xmlUrl:\'rest/model/loadXmlByModelId/\',\r\n        instanceUrl:\'rest/formdetail/getprocessXml/\',\r\n        allExtensionTasks:\'rest/extension/task/get-all-extension-tasks\',\r\n        exportUrl:\'app/rest/models/[]/bpmn20?version=1617092632878\',\r\n        restModels:\'app/rest/models/\'\r\n      }\r\n    }\r\n  },\r\n  computed:{\r\n    xml(){\r\n      this.clearWatermark()\r\n      utils.clearAllHighLight()\r\n      if(this.type===1 && this.xmlId){\r\n        this.instanceId = null\r\n        this.options = Object.assign(this.options,{timeLine:false})\r\n        return `${this.baseApi}${this.url.xmlUrl}${this.xmlId}`\r\n      }else if(this.type===2 && this.instanceId){\r\n        return `${this.baseApi}${this.url.instanceUrl}${this.instanceId}`\r\n      }\r\n    }\r\n  },\r\n  watch:{\r\n    \'taskData\':{\r\n      handler:function (nv){\r\n        nv.forEach(c=>{\r\n          switch (c.status){\r\n            case \'已办\':{\r\n              if(c.approveType === \'驳回\'){\r\n                utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#ff0000\',setline: false,shadow: true})\r\n              } else{\r\n                utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#5BC14B\',setline: false,shadow: false})\r\n              }\r\n            }break;\r\n            case \'待办\':{\r\n              utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#f5842c\',setline: true,shadow:false })\r\n            }break;\r\n          }\r\n        })\r\n      }\r\n    },\r\n    xml(){\r\n      this.loading = true\r\n    }\r\n  },\r\n  methods:{\r\n    getTaskList(){\r\n      if(this.instanceId){\r\n        this.taskData=[]\r\n        axios.get(this.baseApi+this.url.allExtensionTasks,{\r\n          params:{\r\n            initPageIndex:1,\r\n            pageIndex:1,\r\n            pageNum:1,\r\n            pageSize:99,\r\n            processInstanceId:this.instanceId\r\n          }\r\n        }).then(res=>{\r\n          res.data.data.sort((a,b)=>{\r\n            return a.startTime - b.startTime\r\n          }).forEach(f=>{\r\n            utils.setTaskMaxDay(f.taskDefinitionKey,f.customTaskMaxDay+\'天\')\r\n            if(f.realName){\r\n              utils.setTaskRealName(f.taskDefinitionKey,f.realName)\r\n            }\r\n            this.taskData.push(f)\r\n          })\r\n          if(this.taskData.filter(c=>c.status===\'待办\').length===0){\r\n            utils.setEndHighLight({stroke: \'#5ac14a\', fill: \'#53D894\'})\r\n          }\r\n        }).catch(err=>{\r\n          console.error(err)\r\n        }).finally(()=>{\r\n          this.timeLine_loading=false\r\n        })\r\n      }\r\n    },\r\n    bpmnLoadDone(){\r\n      this.loading=false\r\n      if(this.options.timeLine){\r\n        this.getTaskList()\r\n      }\r\n      this.bpmnViewer= this.$refs.bpmnObj.bpmnViewer\r\n      window.bpmnViewer =  this.bpmnViewer\r\n       setTimeout(()=>{\r\n         this.$refs.cBTZoom.handleZoomReset()\r\n       },10)\r\n    },\r\n    bpmnLoadError(){\r\n      this.instanceId=null\r\n      this.loading=false\r\n    },\r\n    clearWatermark(){\r\n      setTimeout(()=>{\r\n        if(document.querySelector(\'.bjs-powered-by\')){\r\n          document.querySelector(\'.bjs-powered-by\').remove()\r\n        }\r\n      },300)\r\n    }\r\n  },\r\n  mounted() {\r\n    this.clearWatermark()\r\n  }\r\n}\r\n<\/script>\r\n\r\n<style scoped>\r\n#bpmn-viewer{\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #F5F5F7;\r\n  cursor: grab;\r\n}\r\n#bpmn-viewer:active{\r\n  cursor: grabbing;\r\n}\r\n.bpmn-viewer-canvas{\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.no-bpmn{\r\n  text-align: center;\r\n}\r\n.no-bpmn img{\r\n  display: inline-block;\r\n  margin-top: 100px;\r\n  width: 700px;\r\n}\r\n</style>\r\n<style>\r\n.bpmn-viewer-canvas .ant-spin-container{\r\n  width: 100% !important;\r\n  height: 100% !important;\r\n}\r\n</style>\r\n']},media:void 0}),e("data-v-60702b8d_1",{source:"\n.bpmn-viewer-canvas .ant-spin-container{\r\n  width: 100% !important;\r\n  height: 100% !important;\n}\r\n",map:{version:3,sources:["E:\\gitlab\\flowable_v3\\sipsd-flowable-editor\\src\\packages\\vue-bpmn-viewer\\VueBpmnViewer.vue"],names:[],mappings:";AAwLA;EACA,sBAAA;EACA,uBAAA;AACA",file:"VueBpmnViewer.vue",sourcesContent:['<template>\r\n  <div id="bpmn-viewer">\r\n    <a-spin :spinning="(type===1&&loading)||(type===2&&timeLine_loading)" tip="加载中..."  wrapperClassName="bpmn-viewer-canvas">\r\n      <vue-bpmn v-if="(instanceId&&type===2)||(xmlId&&type===1)" ref="bpmnObj" :options="bpmnOptions" :url="xml" @shown="bpmnLoadDone" @loading="bpmnLoadDone" @error="bpmnLoadError"></vue-bpmn>\r\n      <div v-else class="no-bpmn">\r\n        <img :src="getAssetsImg(require(\'./assets/no-bpmn.svg\'))">\r\n      </div>\r\n    </a-spin>\r\n    <BTLayout>\r\n      <template slot="head">\r\n        <slot></slot>\r\n      </template>\r\n      <template slot="right">\r\n        <BTZoom v-show="(type===2&&instanceId||type===1&&xmlId)&&options.zoom&&!loading" :bpmnViewer="bpmnViewer" ref="cBTZoom"/>\r\n        <slot name="timeLine" v-if="type===2&&instanceId&&options.timeLine&&!loading" v-bind:loading="timeLine_loading" v-bind:data="taskData">\r\n          <BTimeLine :loading="timeLine_loading" :data="taskData"/>\r\n        </slot>\r\n      </template>\r\n    </BTLayout>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VueBpmn from \'@dpark/vue-bpmn\';\r\nimport bpmnThemeBlue from \'@dpark/bpmn-theme-blue\'\r\nimport {BTimeLine,utils,BTLayout,BTZoom} from \'@dpark/vue-bpmn-controls\'\r\nimport axios from \'axios\'\r\nexport default {\r\n  name: "VueBpmnViewer",\r\n  props:{\r\n    baseApi:{type:String,required:true},\r\n    instanceId:{type:String},\r\n    xmlId:{type:String},\r\n    type:{type:Number,required: true},\r\n    options:{type:Object,default:{\r\n      zoom:true,\r\n      timeLine:true\r\n    }}\r\n  },\r\n  components:{\r\n    VueBpmn,\r\n    BTLayout,\r\n    BTZoom,\r\n    BTimeLine,\r\n  },\r\n  data(){\r\n    return {\r\n      loading:false,\r\n      bpmnViewer:null,\r\n      timeLine_loading:true,\r\n      bpmnOptions:{\r\n        additionalModules:[bpmnThemeBlue]\r\n      },\r\n      taskData:[],\r\n      url:{\r\n        xmlUrl:\'rest/model/loadXmlByModelId/\',\r\n        instanceUrl:\'rest/formdetail/getprocessXml/\',\r\n        allExtensionTasks:\'rest/extension/task/get-all-extension-tasks\',\r\n        exportUrl:\'app/rest/models/[]/bpmn20?version=1617092632878\',\r\n        restModels:\'app/rest/models/\'\r\n      }\r\n    }\r\n  },\r\n  computed:{\r\n    xml(){\r\n      this.clearWatermark()\r\n      utils.clearAllHighLight()\r\n      if(this.type===1 && this.xmlId){\r\n        this.instanceId = null\r\n        this.options = Object.assign(this.options,{timeLine:false})\r\n        return `${this.baseApi}${this.url.xmlUrl}${this.xmlId}`\r\n      }else if(this.type===2 && this.instanceId){\r\n        return `${this.baseApi}${this.url.instanceUrl}${this.instanceId}`\r\n      }\r\n    }\r\n  },\r\n  watch:{\r\n    \'taskData\':{\r\n      handler:function (nv){\r\n        nv.forEach(c=>{\r\n          switch (c.status){\r\n            case \'已办\':{\r\n              if(c.approveType === \'驳回\'){\r\n                utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#ff0000\',setline: false,shadow: true})\r\n              } else{\r\n                utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#5BC14B\',setline: false,shadow: false})\r\n              }\r\n            }break;\r\n            case \'待办\':{\r\n              utils.setTaskHighlight([c.taskDefinitionKey],{color:\'#f5842c\',setline: true,shadow:false })\r\n            }break;\r\n          }\r\n        })\r\n      }\r\n    },\r\n    xml(){\r\n      this.loading = true\r\n    }\r\n  },\r\n  methods:{\r\n    getTaskList(){\r\n      if(this.instanceId){\r\n        this.taskData=[]\r\n        axios.get(this.baseApi+this.url.allExtensionTasks,{\r\n          params:{\r\n            initPageIndex:1,\r\n            pageIndex:1,\r\n            pageNum:1,\r\n            pageSize:99,\r\n            processInstanceId:this.instanceId\r\n          }\r\n        }).then(res=>{\r\n          res.data.data.sort((a,b)=>{\r\n            return a.startTime - b.startTime\r\n          }).forEach(f=>{\r\n            utils.setTaskMaxDay(f.taskDefinitionKey,f.customTaskMaxDay+\'天\')\r\n            if(f.realName){\r\n              utils.setTaskRealName(f.taskDefinitionKey,f.realName)\r\n            }\r\n            this.taskData.push(f)\r\n          })\r\n          if(this.taskData.filter(c=>c.status===\'待办\').length===0){\r\n            utils.setEndHighLight({stroke: \'#5ac14a\', fill: \'#53D894\'})\r\n          }\r\n        }).catch(err=>{\r\n          console.error(err)\r\n        }).finally(()=>{\r\n          this.timeLine_loading=false\r\n        })\r\n      }\r\n    },\r\n    bpmnLoadDone(){\r\n      this.loading=false\r\n      if(this.options.timeLine){\r\n        this.getTaskList()\r\n      }\r\n      this.bpmnViewer= this.$refs.bpmnObj.bpmnViewer\r\n      window.bpmnViewer =  this.bpmnViewer\r\n       setTimeout(()=>{\r\n         this.$refs.cBTZoom.handleZoomReset()\r\n       },10)\r\n    },\r\n    bpmnLoadError(){\r\n      this.instanceId=null\r\n      this.loading=false\r\n    },\r\n    clearWatermark(){\r\n      setTimeout(()=>{\r\n        if(document.querySelector(\'.bjs-powered-by\')){\r\n          document.querySelector(\'.bjs-powered-by\').remove()\r\n        }\r\n      },300)\r\n    }\r\n  },\r\n  mounted() {\r\n    this.clearWatermark()\r\n  }\r\n}\r\n<\/script>\r\n\r\n<style scoped>\r\n#bpmn-viewer{\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #F5F5F7;\r\n  cursor: grab;\r\n}\r\n#bpmn-viewer:active{\r\n  cursor: grabbing;\r\n}\r\n.bpmn-viewer-canvas{\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.no-bpmn{\r\n  text-align: center;\r\n}\r\n.no-bpmn img{\r\n  display: inline-block;\r\n  margin-top: 100px;\r\n  width: 700px;\r\n}\r\n</style>\r\n<style>\r\n.bpmn-viewer-canvas .ant-spin-container{\r\n  width: 100% !important;\r\n  height: 100% !important;\r\n}\r\n</style>\r\n']},media:void 0}))}),c,"data-v-60702b8d",false,undefined,!1,p,void 0,void 0);export default D;
